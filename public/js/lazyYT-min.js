/*
* lazyYT (lazy load YouTube videos)
* v1.2.1 - 2015-09-04
* (CC) This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
* http://creativecommons.org/licenses/by-sa/4.0/
* Contributors: https://github.com/tylerpearson/lazyYT/graphs/contributors || https://github.com/daugilas/lazyYT/graphs/contributors
* 
* Usage: <div class="lazyYT" data-youtube-id="laknj093n" data-parameters="rel=0">loading...</div>
*/
(function(c){function a(r,i){var f=r.data("width"),p=r.data("height"),o=r.attr("title")||r.data("title"),d=r.data("display-title"),l=(r.data("ratio"))?r.data("ratio"):i.default_ratio,s=r.data("display-duration"),e=r.data("youtube-id"),n,g=[],q,j,m=r.text()?r.text():i.loading_text,k=r.data("parameters")||"";l=l.split(":");k+="&"+i.youtube_parameters;if(typeof d!="boolean"){d=i.display_title}if(typeof s!="boolean"){s=i.display_duration}if(typeof f==="number"&&typeof p==="number"){r.width(f);n=p+"px"}else{if(typeof f==="number"){r.width(f);n=(f*l[1]/l[0])+"px"}else{f=r.width();if(f==0){f=r.parent().width()}n=(l[1]/l[0]*100)+"%"}}g.push('<div class="ytp-thumbnail">');g.push('<button class="ytp-large-play-button ytp-button" tabindex="23" aria-live="assertive"');if(f<=320){g.push(' style="transform: scale(0.61);"')}else{if(f<=640){g.push(' style="transform: scale(0.85);"')}}if(d&&o){g.push(' aria-label="',o,'"')}g.push(">");g.push('<svg height="100%" version="1.1" viewBox="0 0 68 48" width="100%">');g.push('<path class="ytp-large-play-button-bg" d="m .66,37.62 c 0,0 .66,4.70 2.70,6.77 2.58,2.71 5.98,2.63 7.49,2.91 5.43,.52 23.10,.68 23.12,.68 .00,-1.3e-5 14.29,-0.02 23.81,-0.71 1.32,-0.15 4.22,-0.17 6.81,-2.89 2.03,-2.07 2.70,-6.77 2.70,-6.77 0,0 .67,-5.52 .67,-11.04 l 0,-5.17 c 0,-5.52 -0.67,-11.04 -0.67,-11.04 0,0 -0.66,-4.70 -2.70,-6.77 C 62.03,.86 59.13,.84 57.80,.69 48.28,0 34.00,0 34.00,0 33.97,0 19.69,0 10.18,.69 8.85,.84 5.95,.86 3.36,3.58 1.32,5.65 .66,10.35 .66,10.35 c 0,0 -0.55,4.50 -0.66,9.45 l 0,8.36 c .10,4.94 .66,9.45 .66,9.45 z" fill="#1f1f1e" fill-opacity="0.9"></path>');g.push('<path d="m 26.96,13.67 18.37,9.62 -18.37,9.55 -0.00,-19.17 z" fill="#fff"></path>');g.push('<path d="M 45.02,23.46 45.32,23.28 26.96,13.67 43.32,24.34 45.02,23.46 z" fill="#ccc"></path>');g.push("</svg>");g.push("</button>");if(s){g.push('<span class="video-time" style="display:none;"></span>')}g.push("</div>");if(d){g.push('<div class="ytp-gradient-top"></div>');g.push('<div class="ytp-chrome-top">');g.push('<div class="ytp-title">');g.push('<div class="ytp-title-text">');g.push('<a id="lazyYT-title-',e,'" class="ytp-title-link" tabindex="13" target="_blank" data-sessionlink="feature=player-title" href="https://www.youtube.com/watch?v=',e,'">');g.push((o)?o:m);g.push("</a>");g.push("</div>");g.push("</div>");g.push("</div>")}r.css({"padding-bottom":n}).html(g.join(""));if(f>640){j="maxresdefault.jpg"}else{if(f>480){j="sddefault.jpg"}else{if(f>320){j="hqdefault.jpg"}else{if(f>120){j="mqdefault.jpg"}else{if(f==0){j="hqdefault.jpg"}else{j="default.jpg"}}}}}q=r.find(".ytp-thumbnail").css({"background-image":["url(http://img.youtube.com/vi/",e,"/",j,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(t){t.preventDefault();if(!r.hasClass("lazyYT-video-loaded")&&q.hasClass("lazyYT-image-loaded")){r.html('<iframe src="//www.youtube.com/embed/'+e+"?"+k+'&autoplay=1" frameborder="0" allowfullscreen></iframe>').addClass(i.video_loaded_class);if(typeof i.callback=="function"){i.callback.call(r)}}});if((!o&&d)||s){var h=["https://www.googleapis.com/youtube/v3/videos?id=",e,"&key=",i.yt_api_key,"&part=snippet"];if(s){h.push(",contentDetails")}c.getJSON(h.join(""),function(u){var t=u.items[0];r.find("#lazyYT-title-"+e).text(t.snippet.title);if(s){r.find(".video-time").text(b(t.contentDetails.duration,i)).show()}})}}function b(k,f){var d=[];var g=0;var h=k.match(/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)W)?(?:(\d*)D)?T(?:(\d*)H)?(?:(\d*)M)?(?:(\d*)S)?/i);var j=[{pos:1,multiplier:86400*365},{pos:2,multiplier:86400*30},{pos:3,multiplier:604800},{pos:4,multiplier:86400},{pos:5,multiplier:3600},{pos:6,multiplier:60},{pos:7,multiplier:1}];for(var e=0;e<j.length;e++){if(typeof h[j[e].pos]!="undefined"){g+=parseInt(h[j[e].pos])*j[e].multiplier}}if(g>3599){d.push(parseInt(g/3600));g%=3600}d.push(("0"+parseInt(g/60)).slice(-2));d.push(("0"+g%60).slice(-2));return d.join(":")}c.fn.lazyYT=function(e,d){var g={yt_api_key:e,youtube_parameters:"rel=0",loading_text:"Loading...",display_title:true,default_ratio:"16:9",display_duration:false,callback:null,video_loaded_class:"lazyYT-video-loaded",container_class:"lazyYT-container"};var f=c.extend(g,d);return this.each(function(){var h=c(this).addClass(f.container_class);a(h,f)})}}(jQuery));