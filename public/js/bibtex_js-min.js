function BibtexParser(){this.pos=0;this.input="";this.entries={};this.strings={JAN:"January",FEB:"February",MAR:"March",APR:"April",MAY:"May",JUN:"June",JUL:"July",AUG:"August",SEP:"September",OCT:"October",NOV:"November",DEC:"December"};this.currentKey="";this.currentEntry="";this.setInput=function(a){this.input=a};this.getEntries=function(){return this.entries};this.isWhitespace=function(a){return(a==" "||a=="\r"||a=="\t"||a=="\n")};this.match=function(a){this.skipWhitespace();if(this.input.substring(this.pos,this.pos+a.length)==a){this.pos+=a.length}else{throw"Token mismatch, expected "+a+", found "+this.input.substring(this.pos)}this.skipWhitespace()};this.tryMatch=function(a){this.skipWhitespace();if(this.input.substring(this.pos,this.pos+a.length)==a){return true}else{return false}this.skipWhitespace()};this.skipWhitespace=function(){while(this.isWhitespace(this.input[this.pos])){this.pos++}if(this.input[this.pos]=="%"){while(this.input[this.pos]!="\n"){this.pos++}this.skipWhitespace()}};this.value_braces=function(){var c=0;this.match("{");var b=this.pos;while(true){if(this.input[this.pos]=="}"&&this.input[this.pos-1]!="\\"){if(c>0){c--}else{var a=this.pos;this.match("}");return this.input.substring(b,a)}}else{if(this.input[this.pos]=="{"){c++}else{if(this.pos==this.input.length-1){throw"Unterminated value"}}}this.pos++}};this.value_quotes=function(){this.match('"');var b=this.pos;while(true){if(this.input[this.pos]=='"'&&this.input[this.pos-1]!="\\"){var a=this.pos;this.match('"');return this.input.substring(b,a)}else{if(this.pos==this.input.length-1){throw"Unterminated value:"+this.input.substring(b)}}this.pos++}};this.single_value=function(){var b=this.pos;if(this.tryMatch("{")){return this.value_braces()}else{if(this.tryMatch('"')){return this.value_quotes()}else{var a=this.key();if(this.strings[a.toUpperCase()]){return this.strings[a]}else{if(a.match("^[0-9]+$")){return a}else{throw"Value expected:"+this.input.substring(b)}}}}};this.value=function(){var a=[];a.push(this.single_value());while(this.tryMatch("#")){this.match("#");a.push(this.single_value())}return a.join("")};this.key=function(){var a=this.pos;while(true){if(this.pos==this.input.length){throw"Runaway key"}if(this.input[this.pos].match("[a-zA-Z0-9_:\\./-]")){this.pos++}else{return this.input.substring(a,this.pos).toUpperCase()}}};this.key_equals_value=function(){var a=this.key();if(this.tryMatch("=")){this.match("=");var b=this.value();return[a,b]}else{throw"... = value expected, equals sign missing:"+this.input.substring(this.pos)}};this.key_value_list=function(){var a=this.key_equals_value();this.entries[this.currentEntry][a[0]]=a[1];while(this.tryMatch(",")){this.match(",");if(this.tryMatch("}")){break}a=this.key_equals_value();this.entries[this.currentEntry][a[0]]=a[1]}};this.entry_body=function(){this.currentEntry=this.key();this.entries[this.currentEntry]=new Object();this.match(",");this.key_value_list()};this.directive=function(){this.match("@");return"@"+this.key()};this.string=function(){var a=this.key_equals_value();this.strings[a[0].toUpperCase()]=a[1]};this.preamble=function(){this.value()};this.comment=function(){this.value()};this.entry=function(){this.entry_body()};this.bibtex=function(){while(this.tryMatch("@")){var a=this.directive().toUpperCase();this.match("{");if(a=="@STRING"){this.string()}else{if(a=="@PREAMBLE"){this.preamble()}else{if(a=="@COMMENT"){this.comment()}else{this.entry()}}}this.match("}")}}}function BibtexDisplay(){this.fixValue=function(a){a=a.replace(/\\glqq\s?/g,"&bdquo;");a=a.replace(/\\grqq\s?/g,"&rdquo;");a=a.replace(/\\ /g,"&nbsp;");a=a.replace(/\\url/g,"");a=a.replace(/---/g,"&mdash;");a=a.replace(/{\\"a}/g,"&auml;");a=a.replace(/\{\\"o\}/g,"&ouml;");a=a.replace(/{\\"u}/g,"&uuml;");a=a.replace(/{\\"A}/g,"&Auml;");a=a.replace(/{\\"O}/g,"&Ouml;");a=a.replace(/{\\"U}/g,"&Uuml;");a=a.replace(/\\ss/g,"&szlig;");a=a.replace(/\{(.*?)\}/g,"$1");return a};this.displayBibtex2=function(g,a){var m=new BibtexParser();m.setInput(g);m.bibtex();var l=m.getEntries();var c=a.find("*");for(var r in l){var k=$(".bibtex_template").clone().removeClass("bibtex_template");k.addClass("unused");for(var p in l[r]){var h=k.find("."+p.toLowerCase());for(var g=0;g<h.size();g++){var j=$(h[g]);j.removeClass("unused");var n=this.fixValue(l[r][p]);if(j.is("a")){j.attr("href",n)}else{var q=j.html()||"";if(q.match("%")){j.html(q.replace("%",n))}else{j.html(n)}}}}var d=k.find("span .unused");d.each(function(b,e){if(e.innerHTML.match("%")){e.innerHTML=""}});a.append(k);k.show()}c.remove()};this.displayBibtex=function(n,d){var m=new BibtexParser();m.setInput(n);m.bibtex();var e=d.find("*");var f=m.getEntries();for(var l in f){var p=f[l];var j=$(".bibtex_template").clone().removeClass("bibtex_template");var r=[];for(var q in p){r.push(q.toUpperCase())}var i=false;do{var h=j.find(".if");if(h.size()==0){break}var k=h.first();k.removeClass("if");var a=true;var c=k.attr("class").split(" ");$.each(c,function(s,b){if(r.indexOf(b.toUpperCase())<0){a=false}k.removeClass(b)});if(!a){k.remove()}}while(true);for(var g in r){var q=r[g];var o=p[q]||"";j.find("span:not(a)."+q.toLowerCase()).html(this.fixValue(o));j.find("a."+q.toLowerCase()).attr("href",this.fixValue(o))}d.append(j);j.show()}e.remove()}}function bibtex_js_draw(){$(".bibtex_template").hide();(new BibtexDisplay()).displayBibtex($("#bibtex_input").val(),$("#bibtex_display"))}if(typeof jQuery=="undefined"){alert("Please include jquery in all pages using bibtex_js!")}else{$(document).ready(function(){if($(".bibtex_template").size()==0){$("body").append('<div class="bibtex_template"><div class="if author" style="font-weight: bold;">\n  <span class="if year">\n    <span class="year"></span>, \n  </span>\n  <span class="author"></span>\n  <span class="if url" style="margin-left: 20px">\n    <a class="url" style="color:black; font-size:10px">(view online)</a>\n  </span>\n</div>\n<div style="margin-left: 10px; margin-bottom:5px;">\n  <span class="title"></span>\n</div></div>')}bibtex_js_draw()})};